<?php

require_once(__DIR__ . '/header.phtml');
?>

    <div class="rooms-wrapper">
        <div class="rooms room-detail">
            <h1>Raum: <?= htmlspecialchars($room['name']) ?></h1>
            <?php
            if (!empty($room['description'])): ?>
                <p class="room-desc"><?= htmlspecialchars($room['description']) ?></p>
            <?php
            endif; ?>

            <?php
            $items = $reminders ?? ($room['reminders'] ?? []);
            ?>

            <h2>Aktuelle Timer</h2>
            <?php
            if (!empty($items)): ?>
                <ul class="list">
                    <?php
                    foreach ($items as $t): ?>
                        <li>
                            <div class="title">
                                <?= htmlspecialchars($t['title'] ?? '') ?>
                            </div>

                            <div class="date">
                                endet am <?= htmlspecialchars($t['due_at'] ?? '') ?>
                            </div>

                            <div class="desc">
                                <?= nl2br(htmlspecialchars($t['notes'] ?? '')) ?>
                            </div>
                        </li>
                    <?php
                    endforeach; ?>
                </ul>
            <?php
            else: ?>
                <p>Keine Einträge vorhanden.</p>
            <?php
            endif; ?>

            <h2>Neuen Reminder hinzufügen</h2>
            <form action="/reminder-submit" method="post">
                <input type="hidden" name="room_id" value="<?= $room['id'] ?>">

                <div>
                    <label for="reminder_title">Titel</label>
                    <input type="text" id="reminder_title" name="reminder_title" required>
                </div>

                <div>
                    <label for="reminder_notes">Notizen</label>
                    <textarea id="reminder_notes" name="reminder_notes" rows="4"></textarea>
                </div>

                <div>
                    <label for="reminder_due_at">Fällig am</label>
                    <input type="datetime-local" id="reminder_due_at" name="reminder_due_at"
                           value="<?= date('Y-m-d\\TH:i', time() + 300) ?>" required>
                </div>

                <div>
                    <label for="reminder_repeat_rules">Wiederholen</label>
                    <select id="reminder_repeat_rules" name="reminder_repeat_rules">
                        <option value="none">Keine Wiederholung</option>
                        <option value="daily">Täglich</option>
                        <option value="weekly">Wöchentlich</option>
                        <option value="monthly">Monatlich</option>
                    </select>
                </div>

                <div>
                    <label for="reminder_priority">Priorität</label>
                    <select id="reminder_priority" name="reminder_priority">
                        <option value="low">Niedrig</option>
                        <option value="medium">Mittel</option>
                        <option value="high">Hoch</option>
                    </select>
                </div>

                <div>
                    <label for="reminder_status">Status</label>
                    <select id="reminder_status" name="reminder_status">
                        <option value="open">Offen</option>
                        <option value="done">Erledigt</option>
                    </select>
                </div>

                <input type="hidden" name="reminder_created_at" value="<?= date('Y-m-d H:i:s') ?>">

                <button type="submit">Reminder anlegen</button>

            </form>
        </div>
    </div>

<?php
require_once(__DIR__ . '/footer.phtml');
?>